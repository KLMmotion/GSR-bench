<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Desktop Organizer Simulator with ROS2</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div id="container">
        <!-- å½“å‰æµ‹è¯•é…ç½®æ˜¾ç¤º -->
        <div id="current-test-config">
            å½“å‰æµ‹è¯•: é…ç½® 1
        </div>
        
        <!-- ä¿¡æ¯é¢æ¿ -->
        <div id="info">
            <div>3D Desktop Organizer Simulator with ROS2</div>
            <div>Drag objects with mouse</div>
            <div>Double-click box with lid to open/close</div>
            <div>Scroll wheel to zoom</div>
        </div>
        
        <!-- ROSçŠ¶æ€é¢æ¿ -->
        <div id="ros-status">
            <div><span class="status-indicator disconnected" id="ros-indicator"></span>ROS2: <span id="ros-connection-status">Disconnected</span></div>
            <div>Scene Graph Topic: /scene_graph</div>
            <div id="scene-graph-info">Scene Graph: Not published</div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div id="controls">
            <button class="control-button" onclick="randomReset()">éšæœºé‡ç½®ä½ç½®</button>
            <button class="control-button" onclick="saveCurrentConfiguration()" style="background-color: #2196F3;">ä¿å­˜å½“å‰é…ç½®</button>
            <button class="control-button" onclick="openConfigManager()" style="background-color: #FF9800;">é…ç½®ç®¡ç†</button>
            <button class="control-button" id="auto-test-btn" onclick="startAutoTest()" style="background-color: #4CAF50;">å¼€å§‹è‡ªåŠ¨æµ‹è¯•</button>
            <button class="control-button" id="stop-test-btn" onclick="stopAutoTest()" style="background-color: #f44336; display: none;">åœæ­¢æµ‹è¯•</button>
            <button class="control-button" onclick="saveCommandLog()" style="background-color: #9C27B0;">ä¿å­˜æŒ‡ä»¤çŠ¶æ€</button>
            <button class="control-button" onclick="openAssetSelector()" style="background-color: #00BCD4;">ğŸ“¦ åŠ è½½æ¨¡å‹</button>
            <button class="control-button" onclick="openObjectList()" style="background-color: #E91E63;">ğŸ“‹ ç‰©ä½“åˆ—è¡¨</button>
        </div>
        
        <!-- ä»»åŠ¡çŠ¶æ€æ˜¾ç¤ºçª—å£ -->
        <div id="task-status-display" style="display: none;">
            <div id="task-status-text">Waiting for task...</div>
        </div>
        
        <!-- å½“å‰å‘½ä»¤æ˜¾ç¤ºçª—å£ -->
        <div id="current-command-display">
            <div id="current-command-text">Thinking...</div>
        </div>
        
        <!-- å‘½ä»¤çŠ¶æ€çª—å£ -->
        <div id="command-status">
            <div id="command-status-title">æŒ‡ä»¤çŠ¶æ€</div>
            <div id="command-log">
                <div class="log-entry">Thinking...</div>
            </div>
        </div>

        <!-- é…ç½®ç®¡ç†å™¨çª—å£ -->
        <div id="config-manager">
            <h3>é…ç½®ç®¡ç†å™¨</h3>
            <button class="close-manager close-manager-top" onclick="closeConfigManager()">å…³é—­</button>
            <div class="config-selector">
                <div>é€‰æ‹©é…ç½®:</div>
                <input type="range" id="config-slider" class="config-slider" min="1" max="1" value="1" onchange="updateSelectedConfig(this.value)">
                <div class="selected-config" id="selected-config-display">é…ç½® #1</div>
                <div style="margin: 10px 0;">
                    <button class="config-button load-button" onclick="loadSelectedConfiguration()">åŠ è½½é€‰ä¸­é…ç½®</button>
                </div>
            </div>
            <div id="config-list">
                <!-- é…ç½®é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€å¡«å…… -->
            </div>
            <button class="close-manager close-manager-bottom" onclick="closeConfigManager()">å…³é—­</button>
        </div>
        
        <!-- ä»»åŠ¡æŸ¥è¯¢å¯¹è¯æ¡† -->
        <div id="task-query-dialog">
            <h3>ä»»åŠ¡æè¿°</h3>
            <div class="task-input-section">
                <label class="task-input-label">è¯·æè¿°è¿™ä¸ªé…ç½®å¯¹åº”çš„ä»»åŠ¡:</label>
                <textarea id="task-query-input" placeholder="ä¾‹å¦‚ï¼šå°†æ‰€æœ‰æ¯å­æ”¾åˆ°ç›¸åŒé¢œè‰²çš„ç›’å­ä¸­..." maxlength="500"></textarea>
            </div>
            <div class="default-options-section">
                <span class="default-options-title">å¿«é€Ÿé€‰æ‹©:</span>
                <div class="default-option" onclick="selectDefaultOption('move all blue_mug to be on table')">
                    move all blue_mug to be on table
                </div>
                <div class="default-option" onclick="selectDefaultOption('move all yellow_mug in yellow_box')">
                    move all yellow_mug in yellow_box
                </div>
                <div class="default-option" onclick="selectDefaultOption('Put all the mug into their corresponding colored boxes')">
                    Put all the mug into their corresponding colored boxes
                </div>
                <div class="default-option" onclick="selectDefaultOption('Empty all the boxes, stack the boxes up, and place the blue_box on top.')">
                    Empty all the boxes, stack the boxes up, and place the blue_box on top.
                </div>
                <div class="default-option" onclick="selectDefaultOption('Put all the mug into their corresponding colored boxes and stack the boxes up.')">
                    Put all the mug into their corresponding colored boxes and stack the boxes up.
                </div>
                <div class="default-option" onclick="selectDefaultOption('Place all mug into their corresponding colored boxes, stack the boxes up, and place the blue_box on top.')">
                    Place all mug into their corresponding colored boxes, stack the boxes up, and place the blue_box on top.
                </div>
            </div>
            <div class="task-dialog-buttons">
                <button class="task-dialog-button cancel-task-button" onclick="cancelTaskQuery()">å–æ¶ˆ</button>
                <button class="task-dialog-button confirm-task-button" id="confirm-task-btn" onclick="confirmTaskQuery()">ç¡®è®¤ä¿å­˜</button>
            </div>
        </div>

        <!-- èµ„äº§é€‰æ‹©å™¨å¯¹è¯æ¡† -->
        <div id="asset-selector-overlay" onclick="closeAssetSelector()"></div>
        <div id="asset-selector-dialog">
            <h2>ğŸ“¦ é€‰æ‹©è¦åŠ è½½çš„æ¨¡å‹</h2>
            <div id="asset-list-container"></div>
            <button class="asset-selector-close" onclick="closeAssetSelector()">å…³é—­</button>
        </div>
        
        <!-- ç‰©ä½“åˆ—è¡¨å¯¹è¯æ¡† -->
        <div id="object-list-overlay" onclick="closeObjectList()"></div>
        <div id="object-list-dialog">
            <h2>ğŸ“‹ åœºæ™¯ç‰©ä½“åˆ—è¡¨</h2>
            <div id="object-list-container"></div>
            <button class="object-list-close" onclick="closeObjectList()">å…³é—­</button>
        </div>
    </div>
    
    <!-- ROS Bridge library -->
    <script src="https://unpkg.com/roslib@1.3.0/build/roslib.min.js"></script>
    
    <!-- Import maps for modern Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.155.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.155.0/examples/jsm/",
            "cannon-es": "https://unpkg.com/cannon-es@0.20.0/dist/cannon-es.js"
        }
    }
    </script>
    
    <!-- Main application module with cache buster -->
    <script type="module" src="src/main.js?v=20250102"></script>
</body>
</html>
